{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { isIos } from \"@zag-js/dom-query\"\n\nconst LOCK_CLASSNAME = \"data-zag-scroll-lock\"\n\nfunction assignStyle(el: HTMLElement | null | undefined, style: Partial<CSSStyleDeclaration>) {\n  if (!el) return\n  const previousStyle = el.style.cssText\n  Object.assign(el.style, style)\n  return () => {\n    el.style.cssText = previousStyle\n  }\n}\n\nfunction setCSSProperty(el: HTMLElement | null | undefined, property: string, value: string) {\n  if (!el) return\n  const previousValue = el.style.getPropertyValue(property)\n  el.style.setProperty(property, value)\n  return () => {\n    if (previousValue) {\n      el.style.setProperty(property, previousValue)\n    } else {\n      el.style.removeProperty(property)\n    }\n  }\n}\n\nfunction getPaddingProperty(documentElement: HTMLElement) {\n  // RTL <body> scrollbar\n  const documentLeft = documentElement.getBoundingClientRect().left\n  const scrollbarX = Math.round(documentLeft) + documentElement.scrollLeft\n  return scrollbarX ? \"paddingLeft\" : \"paddingRight\"\n}\n\nexport function preventBodyScroll(_document?: Document) {\n  const doc = _document ?? document\n  const win = doc.defaultView ?? window\n\n  const { documentElement, body } = doc\n\n  const locked = body.hasAttribute(LOCK_CLASSNAME)\n  if (locked) return\n\n  body.setAttribute(LOCK_CLASSNAME, \"\")\n\n  const scrollbarWidth = win.innerWidth - documentElement.clientWidth\n  const setScrollbarWidthProperty = () => setCSSProperty(documentElement, \"--scrollbar-width\", `${scrollbarWidth}px`)\n  const paddingProperty = getPaddingProperty(documentElement)\n\n  const setStyle = () =>\n    assignStyle(body, {\n      overflow: \"hidden\",\n      [paddingProperty]: `${scrollbarWidth}px`,\n    })\n\n  // Only iOS doesn't respect `overflow: hidden` on document.body\n  const setIOSStyle = () => {\n    const { scrollX, scrollY, visualViewport } = win\n\n    // iOS 12 does not support `visuaViewport`.\n    const offsetLeft = visualViewport?.offsetLeft ?? 0\n    const offsetTop = visualViewport?.offsetTop ?? 0\n\n    const restoreStyle = assignStyle(body, {\n      position: \"fixed\",\n      overflow: \"hidden\",\n      top: `${-(scrollY - Math.floor(offsetTop))}px`,\n      left: `${-(scrollX - Math.floor(offsetLeft))}px`,\n      right: \"0\",\n      [paddingProperty]: `${scrollbarWidth}px`,\n    })\n\n    return () => {\n      restoreStyle?.()\n      win.scrollTo({ left: scrollX, top: scrollY, behavior: \"instant\" })\n    }\n  }\n\n  const cleanups = [setScrollbarWidthProperty(), isIos() ? setIOSStyle() : setStyle()]\n\n  return () => {\n    cleanups.forEach((fn) => fn?.())\n    body.removeAttribute(LOCK_CLASSNAME)\n  }\n}\n"],"mappings":";AAAA,SAAS,aAAa;AAEtB,IAAM,iBAAiB;AAEvB,SAAS,YAAY,IAAoC,OAAqC;AAC5F,MAAI,CAAC,GAAI;AACT,QAAM,gBAAgB,GAAG,MAAM;AAC/B,SAAO,OAAO,GAAG,OAAO,KAAK;AAC7B,SAAO,MAAM;AACX,OAAG,MAAM,UAAU;AAAA,EACrB;AACF;AAEA,SAAS,eAAe,IAAoC,UAAkB,OAAe;AAC3F,MAAI,CAAC,GAAI;AACT,QAAM,gBAAgB,GAAG,MAAM,iBAAiB,QAAQ;AACxD,KAAG,MAAM,YAAY,UAAU,KAAK;AACpC,SAAO,MAAM;AACX,QAAI,eAAe;AACjB,SAAG,MAAM,YAAY,UAAU,aAAa;AAAA,IAC9C,OAAO;AACL,SAAG,MAAM,eAAe,QAAQ;AAAA,IAClC;AAAA,EACF;AACF;AAEA,SAAS,mBAAmB,iBAA8B;AAExD,QAAM,eAAe,gBAAgB,sBAAsB,EAAE;AAC7D,QAAM,aAAa,KAAK,MAAM,YAAY,IAAI,gBAAgB;AAC9D,SAAO,aAAa,gBAAgB;AACtC;AAEO,SAAS,kBAAkB,WAAsB;AACtD,QAAM,MAAM,aAAa;AACzB,QAAM,MAAM,IAAI,eAAe;AAE/B,QAAM,EAAE,iBAAiB,KAAK,IAAI;AAElC,QAAM,SAAS,KAAK,aAAa,cAAc;AAC/C,MAAI,OAAQ;AAEZ,OAAK,aAAa,gBAAgB,EAAE;AAEpC,QAAM,iBAAiB,IAAI,aAAa,gBAAgB;AACxD,QAAM,4BAA4B,MAAM,eAAe,iBAAiB,qBAAqB,GAAG,cAAc,IAAI;AAClH,QAAM,kBAAkB,mBAAmB,eAAe;AAE1D,QAAM,WAAW,MACf,YAAY,MAAM;AAAA,IAChB,UAAU;AAAA,IACV,CAAC,eAAe,GAAG,GAAG,cAAc;AAAA,EACtC,CAAC;AAGH,QAAM,cAAc,MAAM;AACxB,UAAM,EAAE,SAAS,SAAS,eAAe,IAAI;AAG7C,UAAM,aAAa,gBAAgB,cAAc;AACjD,UAAM,YAAY,gBAAgB,aAAa;AAE/C,UAAM,eAAe,YAAY,MAAM;AAAA,MACrC,UAAU;AAAA,MACV,UAAU;AAAA,MACV,KAAK,GAAG,EAAE,UAAU,KAAK,MAAM,SAAS,EAAE;AAAA,MAC1C,MAAM,GAAG,EAAE,UAAU,KAAK,MAAM,UAAU,EAAE;AAAA,MAC5C,OAAO;AAAA,MACP,CAAC,eAAe,GAAG,GAAG,cAAc;AAAA,IACtC,CAAC;AAED,WAAO,MAAM;AACX,qBAAe;AACf,UAAI,SAAS,EAAE,MAAM,SAAS,KAAK,SAAS,UAAU,UAAU,CAAC;AAAA,IACnE;AAAA,EACF;AAEA,QAAM,WAAW,CAAC,0BAA0B,GAAG,MAAM,IAAI,YAAY,IAAI,SAAS,CAAC;AAEnF,SAAO,MAAM;AACX,aAAS,QAAQ,CAAC,OAAO,KAAK,CAAC;AAC/B,SAAK,gBAAgB,cAAc;AAAA,EACrC;AACF;","names":[]}